<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NeoX Catch Game ‚Äì Level 3</title>
<style>
  html,body{
    margin:0;height:100%;overflow:hidden;background:#020414;
    font-family:Arial,Helvetica,sans-serif;color:white;
  }
  canvas{
    display:block;margin:0 auto;
    background:url('https://neoxcoin.github.io/neox-game/PhotoOpening3.PNG') center/cover no-repeat;
  }

  #hud{
    position:fixed;top:12px;left:50%;transform:translateX(-50%);
    font-size:22px;font-weight:bold;text-shadow:0 0 6px #000;
  }

  #endOverlay{
    position:fixed;inset:0;display:none;place-items:center;z-index:999;
    background:rgba(3,6,23,0.8);
  }
  #endWrap{
    position:relative;width:100%;height:100%;display:grid;place-items:center;
  }
  #endVideo{
    width:100%;height:100%;object-fit:contain;opacity:0;background:#000;
    transition:opacity 1s ease;
  }
  .endCtrl{
    position:absolute;left:50%;bottom:10%;
    transform:translateX(-50%);
    display:flex;gap:12px;justify-content:center;
  }
  .endCtrl button{
    background:#1f2a5a;border:0;color:#fff;font-weight:800;padding:12px 18px;
    border-radius:12px;box-shadow:0 0 20px rgba(43,124,255,.45);
    cursor:pointer;font-size:16px;
  }
  .endCtrl button:hover{background:#2563eb;}
</style>
</head>
<body>

<canvas id="gameCanvas" width="420" height="720"></canvas>
<div id="hud">Score: <span id="score">0</span> | Best: <span id="best">0</span></div>

<!-- End Game ÂãïÁï´Â±§ -->
<section id="endOverlay">
  <div id="endWrap">
    <video id="endVideo" playsinline webkit-playsinline></video>
    <div class="endCtrl">
      <button id="btnHome">üè† Return to Homepage</button>
    </div>
  </div>
</section>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
let score = parseInt(localStorage.getItem("neox-l2-score")) || 0;
let best = parseInt(localStorage.getItem("neox-l3-best")) || 0;
scoreEl.textContent = score;
bestEl.textContent = best;

const player = { x: canvas.width/2 - 25, y: canvas.height - 80, w: 50, h: 50, speed: 6 };
let coins = [];
let gameOver = false;

// ÁîüÊàê‰∏çÂêåÈ°èËâ≤ Coin
function spawnCoin(){
  const types = [
    {color:'gold',value:10,prob:0.5},
    {color:'blue',value:30,prob:0.3},
    {color:'red',value:50,prob:0.2},
  ];
  const r = Math.random();
  let chosen = types[0];
  let acc = 0;
  for (const t of types){ acc+=t.prob; if (r<=acc){ chosen=t; break; } }
  coins.push({
    x:Math.random()*(canvas.width-30),y:-40,w:30,h:30,
    color:chosen.color,value:chosen.value,speed:3+Math.random()*2
  });
}

function drawPlayer(){
  ctx.fillStyle="#41b0ff";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function drawCoins(){
  for (const c of coins){
    ctx.fillStyle=c.color;
    ctx.beginPath();
    ctx.arc(c.x+c.w/2,c.y+c.h/2,15,0,Math.PI*2);
    ctx.fill();
  }
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlayer();
  drawCoins();
  for (let i=coins.length-1;i>=0;i--){
    const c = coins[i];
    c.y += c.speed;

    // Á¢∞ÊíûÂà§ÂÆö
    if (c.y+c.h>player.y && c.x+ c.w>player.x && c.x<player.x+player.w && c.y<player.y+player.h){
      score += c.value;
      coins.splice(i,1);
      if(score>best){best=score;localStorage.setItem("neox-l3-best",best);}
      scoreEl.textContent = score; bestEl.textContent=best;
    }
    else if (c.y>canvas.height){
      score -= 5;
      if(score<0)score=0;
      coins.splice(i,1);
      scoreEl.textContent = score;
    }
  }
  if(!gameOver) requestAnimationFrame(update);
}

let keys={};
addEventListener('keydown',e=>keys[e.key]=true);
addEventListener('keyup',e=>keys[e.key]=false);
function movePlayer(){
  if(keys["ArrowLeft"]||keys["a"]) player.x -= player.speed;
  if(keys["ArrowRight"]||keys["d"]) player.x += player.speed;
  player.x=Math.max(0,Math.min(canvas.width-player.w,player.x));
  if(!gameOver) requestAnimationFrame(movePlayer);
}

// ÈÅäÊà≤ÈÇèËºØÂïüÂãï
let spawnInterval=setInterval(spawnCoin,800);
update();
movePlayer();

// ÈÅäÊà≤ÊôÇÈñìÔºà60ÁßíÔºâ
setTimeout(()=>{
  gameOver=true;
  clearInterval(spawnInterval);
  localStorage.setItem("neox-l3-score",score);
  showEndAnimation();
},60000);

// End Game ÂãïÁï´ÊéßÂà∂
const endOverlay=document.getElementById('endOverlay');
const endVideo=document.getElementById('endVideo');
const btnHome=document.getElementById('btnHome');

function showEndAnimation(){
  endOverlay.style.display='grid';
  endVideo.src='https://neoxcoin.github.io/neox-game/NeoX_End_Game_VictoryGlow%202.mp4';
  endVideo.play().then(()=>endVideo.style.opacity='1').catch(()=>endVideo.style.opacity='1');
}

btnHome.addEventListener('click',()=>{
  window.location.href='index.html';
});
</script>
</body>
</html>