<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Catch — Opening 3</title>
<style>
  :root{
    --pad: clamp(10px, 3.5vw, 18px);
  }
  html,body{
    margin:0;
    height:100%;
    background:#000;
    color:#fff;
    font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang TC", "Noto Sans", Arial, sans-serif;
    overflow:hidden;
  }

  /* 包覆層：用 fixed + dvh/svh 避免 iOS 橫向位置下移 */
  #wrap{
    position:fixed;
    inset:0;
    display:grid;
    place-items:center;
    /* 先顯示固定圖片，避免黑屏 */
    background:#000 url('PhotoOpening3.PNG') center / contain no-repeat;
    /* 高度兼容： */
    height:100vh;          /* fallback */
    height:100svh;         /* iOS 15+ */
    height:100dvh;         /* 現代瀏覽器 */
  }

  /* 影片：維持原比例、不裁切不放大 */
  video{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:contain; /* 👈 保持比例 */
    background:#000 url('PhotoOpening3.PNG') center / contain no-repeat; /* poster 保險 */
    border-radius:0;
    opacity:0;                               /* 載入好再淡入 */
    transition:opacity .4s ease;
  }

  /* 底部文字＋按鈕層 */
  .overlay{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    justify-content:flex-end;
    align-items:center;
    text-align:center;
    background:linear-gradient(transparent 55%, rgba(0,0,0,.7));
    padding-bottom:calc(var(--pad) + env(safe-area-inset-bottom));
  }

  h1{
    margin:0 0 8px;
    font-size:clamp(22px, 5.8vw, 36px);
    font-weight:900;
    text-shadow:0 0 18px rgba(65,176,255,.4);
  }
  p{
    margin:0 0 14px;
    font-size:clamp(13px, 3.5vw, 16px);
    color:#cfe0ff;
  }

  .btnrow{
    display:flex;
    gap:10px;
    flex-wrap:nowrap;         /* 直向也保持同一行 */
    justify-content:center;
  }
  button{
    border:0;
    border-radius:12px;
    padding:10px 14px;
    font-weight:800;
    letter-spacing:.02em;
    color:#fff;
    background:#1f2a5a;
    box-shadow:0 8px 22px rgba(43,124,255,.28), inset 0 0 0 1px rgba(255,255,255,.08);
    cursor:pointer;
  }
  .primary{ background:#2b7cff; }

  /* 橫向也固定在同一水平，稍微把底部間距拉近 */
  @media (orientation:landscape){
    .overlay{ padding-bottom:calc(10px + env(safe-area-inset-bottom)); }
    .btnrow{ gap:12px; }
  }
</style>
</head>
<body>
  <section id="wrap">
    <video id="openerVideo"
      src="TreasureL3Opening.mp4"
      poster="PhotoOpening3.PNG"
      preload="auto"
      muted
      playsinline
      webkit-playsinline
    ></video>

    <div class="overlay">
      <h1>Treasure Journey</h1>
      <p>Watch the short opening, or skip and start the level.</p>
      <div class="btnrow">
        <button id="btnSound">🔈 Play with sound</button>
        <button id="btnStart" class="primary">▶ Start Play</button>
        <button id="btnSkip">⏭ Skip</button>
      </div>
    </div>
  </section>

<script>
const video   = document.getElementById('openerVideo');
const btnSound= document.getElementById('btnSound');
const btnStart= document.getElementById('btnStart');
const btnSkip = document.getElementById('btnSkip');

/* 1) 避免載入黑屏：poster 立即顯示，等有畫面再淡入 */
function reveal(){ video.style.opacity = '1'; }
video.addEventListener('loadeddata', reveal);
video.addEventListener('loadedmetadata', reveal);

/* 2) iOS 需要一次互動才可播放/開聲 */
let audioCtx;
function ensureAudio(){
  if(!audioCtx){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
}

btnStart.addEventListener('click', async ()=>{
  try{ await video.play(); }catch(e){}
});

btnSound.addEventListener('click', async ()=>{
  ensureAudio();
  try{
    await audioCtx.resume();
    if(video.paused) await video.play();
    video.muted = false;
    btnSound.textContent = '🔊 Sound on';
    btnSound.disabled = true;
  }catch(e){}
});

btnSkip.addEventListener('click', ()=>{
  try{ video.pause(); }catch(e){}
  location.href = 'v3.html';          // 跳去第三關
});

/* 3) 播完自動進入 v3.html */
video.addEventListener('ended', ()=> location.href='v3.html');

/* 保險：第一次觸碰就解鎖播放，仍維持原比例 */
['pointerdown','touchend','click','keydown'].forEach(evt=>{
  window.addEventListener(evt, async ()=>{
    if(video.paused){
      try{ await video.play(); }catch(e){}
    }
  }, { once:true, passive:true });
});
</script>
</body>
</html>