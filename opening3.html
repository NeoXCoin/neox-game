<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Catch — Opening 3</title>
<style>
  :root{ --pad: clamp(10px, 3.5vw, 18px); }

  html,body{
    margin:0;height:100%;background:#000;color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif;
    overflow:hidden;
  }

  /* 影片容器：固定鋪滿視窗，先顯示海報避免黑屏 */
  #wrap{
    position:fixed; inset:0; display:grid; place-items:center;
    height:100vh; height:100svh; height:100dvh;
    background:#000 url('PhotoOpening3.PNG') center / contain no-repeat;
  }

  /* 影片：等比完整顯示 */
  #openerVideo{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:contain; object-position:center center;
    background:#000 url('PhotoOpening3.PNG') center / contain no-repeat;
    opacity:0; transition:opacity .4s ease;
  }

  /* 底部控制欄（會自動淡出） */
  .overlay{
    position:absolute; inset:0; display:flex; flex-direction:column;
    justify-content:flex-end; align-items:center; text-align:center;
    background:linear-gradient(transparent 55%, rgba(0,0,0,.7));
    padding-bottom:calc(var(--pad) + env(safe-area-inset-bottom));
    opacity:1; transition:opacity .35s ease;
  }
  .overlay.hide{ opacity:0; pointer-events:none; }

  h1{ margin:0 0 8px; font-size:clamp(22px,5.8vw,36px); font-weight:900; text-shadow:0 0 18px rgba(65,176,255,.4); }
  p { margin:0 0 14px; font-size:clamp(13px,3.5vw,16px); color:#cfe0ff; }

  .btnrow{ display:flex; gap:10px; flex-wrap:nowrap; justify-content:center; }
  button{
    border:0; border-radius:12px; padding:10px 14px; font-weight:800; letter-spacing:.02em;
    color:#fff; background:#1f2a5a; cursor:pointer;
    box-shadow:0 8px 22px rgba(43,124,255,.28), inset 0 0 0 1px rgba(255,255,255,.08);
    transition:transform .15s ease;
  }
  button:active{ transform:scale(.96); }
  .primary{ background:#2b7cff; }

  @media (orientation:landscape){
    .overlay{ padding-bottom:calc(10px + env(safe-area-inset-bottom)); }
    .btnrow{ gap:12px; }
  }
</style>
</head>
<body>
  <section id="wrap">
    <video id="openerVideo"
      src="TreasureL3Opening.mp4"
      poster="PhotoOpening3.PNG"
      preload="auto" muted playsinline webkit-playsinline></video>

    <div class="overlay" id="overlay">
      <h1>Treasure Journey</h1>
      <p>Watch the short opening, or skip and start the level.</p>
      <div class="btnrow">
        <button id="btnSound">🔈 Play with sound</button>
        <button id="btnStart" class="primary">▶ Start Play</button>
        <button id="btnSkip">⏭ Skip</button>
      </div>
    </div>
  </section>

<script>
const video    = document.getElementById('openerVideo');
const overlay  = document.getElementById('overlay');
const btnSound = document.getElementById('btnSound');
const btnStart = document.getElementById('btnStart');
const btnSkip  = document.getElementById('btnSkip');

/* 顯示影片畫面（避免黑屏） */
function reveal(){ video.style.opacity = '1'; }
video.addEventListener('loadeddata', reveal);
video.addEventListener('loadedmetadata', reveal);
video.play().catch(()=>{}); // 嘗試自動播放（靜音）

/* ===== 控制欄：5 秒無操作自動淡出；有互動就再顯示並重置計時 ===== */
let hideTimer=null;
function scheduleHide(){
  clearTimeout(hideTimer);
  hideTimer = setTimeout(()=> overlay.classList.add('hide'), 5000);
}
function showControls(){
  overlay.classList.remove('hide');
  scheduleHide();
}
scheduleHide(); // 初始計時

['mousemove','pointermove','pointerdown','touchstart','keydown'].forEach(evt=>{
  window.addEventListener(evt, showControls, {passive:true});
});

/* ===== 按鈕動作 ===== */
let audioCtx;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }

btnSound.addEventListener('click', async ()=>{
  ensureAudio();
  try{
    await audioCtx.resume();
    if(video.paused) await video.play();
    video.muted = false;
    btnSound.textContent = '🔊 Sound on';
    btnSound.disabled = true;
  }catch(e){}
});

function goNext(){ location.href = 'v3.html'; }
btnStart.addEventListener('click', goNext);
btnSkip .addEventListener('click', goNext);

/* 影片播完也自動進入遊戲 */
video.addEventListener('ended', goNext);

/* 第一次觸控時確保可以播放（iOS 解鎖） */
['pointerdown','touchend','click','keydown'].forEach(evt=>{
  window.addEventListener(evt, async ()=>{
    if(video.paused){ try{ await video.play(); }catch(e){} }
  }, { once:true, passive:true });
});
</script>
</body>
</html>