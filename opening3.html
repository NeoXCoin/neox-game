<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Catch â€” Opening 3</title>
<style>
  :root{ --pad: clamp(10px, 3.5vw, 18px); }

  html,body{
    margin:0;height:100%;background:#000;color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif;
    overflow:hidden;
  }

  /* å½±ç‰‡å®¹å™¨ï¼šå›ºå®šé‹ªæ»¿è¦–çª—ï¼Œå…ˆé¡¯ç¤ºæµ·å ±é¿å…é»‘å± */
  #wrap{
    position:fixed; inset:0; display:grid; place-items:center;
    height:100vh; height:100svh; height:100dvh;
    background:#000 url('PhotoOpening3.PNG') center / contain no-repeat;
  }

  /* å½±ç‰‡ï¼šç­‰æ¯”å®Œæ•´é¡¯ç¤º */
  #openerVideo{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:contain; object-position:center center;
    background:#000 url('PhotoOpening3.PNG') center / contain no-repeat;
    opacity:0; transition:opacity .4s ease;
  }

  /* åº•éƒ¨æ§åˆ¶æ¬„ï¼ˆæœƒè‡ªå‹•æ·¡å‡ºï¼‰ */
  .overlay{
    position:absolute; inset:0; display:flex; flex-direction:column;
    justify-content:flex-end; align-items:center; text-align:center;
    background:linear-gradient(transparent 55%, rgba(0,0,0,.7));
    padding-bottom:calc(var(--pad) + env(safe-area-inset-bottom));
    opacity:1; transition:opacity .35s ease;
  }
  .overlay.hide{ opacity:0; pointer-events:none; }

  h1{
    margin:0 0 8px; font-size:clamp(22px,5.8vw,36px); font-weight:900;
    text-shadow:0 0 22px rgba(43,124,255,.45);
    letter-spacing:.02em;
  }
  p { margin:0 0 14px; font-size:clamp(13px,3.5vw,16px); color:#cfe0ff; }

  /* === æŒ‰éˆ•æ’ç‰ˆ === */
  .btnrow{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }

  /* === çµ±ä¸€æ¼‚äº®æŒ‰éˆ•æ¨£å¼ï¼ˆå’Œ Opening2 ä¸€è‡´ï¼‰ === */
  .btnrow button{
    appearance:none;
    border:0; border-radius:14px;
    padding:12px 18px;
    font-weight:800; letter-spacing:.02em;
    color:#fff;
    background: linear-gradient(180deg, #2c3363 0%, #1a1f40 100%);
    box-shadow: 0 10px 28px rgba(0,0,0,.4),
                inset 0 0 0 1px rgba(255,255,255,.08);
    cursor:pointer;
    transition: transform .15s ease, box-shadow .25s ease, filter .25s ease;
    display:inline-flex; align-items:center; gap:6px;
  }
  .btnrow button:hover{
    transform: translateY(-2px);
    filter: brightness(1.15);
    box-shadow: 0 14px 34px rgba(43,124,255,.35),
                inset 0 0 0 1px rgba(255,255,255,.12);
  }
  .btnrow button:active{
    transform: translateY(0);
    filter: brightness(.95);
    box-shadow: 0 8px 18px rgba(0,0,0,.35);
  }
  .btnrow button:focus-visible{
    outline:none;
    box-shadow:
      0 0 0 3px rgba(43,124,255,.25),
      0 0 0 6px rgba(43,124,255,.2),
      0 10px 28px rgba(0,0,0,.4),
      inset 0 0 0 1px rgba(255,255,255,.1);
  }

  /* ä¸»æŒ‰éˆ•ï¼ˆStartï¼‰ï¼šè—è‰²äº®é¢ + å¤–ç™¼å…‰ */
  .primary{
    background: linear-gradient(180deg, #4c8dff 0%, #2b7cff 70%, #236cf0 100%);
    box-shadow: 0 0 25px rgba(43,124,255,.25),
                0 10px 28px rgba(0,0,0,.4),
                inset 0 0 0 1px rgba(255,255,255,.15);
  }
  .primary:hover{
    filter: brightness(1.2);
    box-shadow: 0 0 30px rgba(43,124,255,.4),
                0 12px 32px rgba(0,0,0,.45);
  }

  /* çª„å±å„ªåŒ– */
  @media (orientation:landscape){
    .overlay{ padding-bottom:calc(10px + env(safe-area-inset-bottom)); }
    .btnrow{ gap:12px; }
  }
  @media (max-width:500px){
    .btnrow button{ padding:11px 14px; font-size:14px; }
  }
</style>
</head>
<body>
  <section id="wrap">
    <video id="openerVideo"
      src="TreasureL3Opening.mp4"
      poster="PhotoOpening3.PNG"
      preload="auto" muted playsinline webkit-playsinline></video>

    <div class="overlay" id="overlay">
      <h1>Treasure Journey</h1>
      <p>Watch the short opening, or skip and start the level.</p>
      <div class="btnrow">
        <button id="btnSound">ğŸ”ˆ Sound off</button>
        <button id="btnStart" class="primary">â–¶ Start Play</button>
        <button id="btnSkip">â­ Skip</button>
        <!-- âŒ ä¸è¦ Skinï¼šå·²ç§»é™¤ -->
      </div>
    </div>
  </section>

<script>
const video    = document.getElementById('openerVideo');
const overlay  = document.getElementById('overlay');
const btnSound = document.getElementById('btnSound');
const btnStart = document.getElementById('btnStart');
const btnSkip  = document.getElementById('btnSkip');

/* é¡¯ç¤ºå½±ç‰‡ç•«é¢ï¼ˆé¿å…é»‘å±ï¼‰ */
function reveal(){ video.style.opacity = '1'; }
video.addEventListener('loadeddata', reveal);
video.addEventListener('loadedmetadata', reveal);
video.play().catch(()=>{}); // å˜—è©¦è‡ªå‹•æ’­æ”¾ï¼ˆéœéŸ³ï¼‰

/* æ§åˆ¶æ¬„ï¼š5 ç§’ç„¡æ“ä½œè‡ªå‹•æ·¡å‡ºï¼›æœ‰äº’å‹•å°±å†é¡¯ç¤ºä¸¦é‡ç½®è¨ˆæ™‚ */
let hideTimer=null;
function scheduleHide(){ clearTimeout(hideTimer); hideTimer = setTimeout(()=> overlay.classList.add('hide'), 5000); }
function showControls(){ overlay.classList.remove('hide'); scheduleHide(); }
scheduleHide();
['mousemove','pointermove','pointerdown','touchstart','keydown'].forEach(evt=>{
  window.addEventListener(evt, showControls, {passive:true});
});

/* éŸ³è¨Šï¼šSound on/off åˆ‡æ› */
let audioCtx;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function updateSoundLabel(){ btnSound.textContent = video.muted ? 'ğŸ”ˆ Sound off' : 'ğŸ”Š Sound on'; }
btnSound.addEventListener('click', async ()=>{
  ensureAudio();
  try{
    await audioCtx.resume();
    video.muted = !video.muted;
    if(!video.muted && video.paused){ try{ await video.play(); }catch(e){} }
    updateSoundLabel();
  }catch(e){}
});
updateSoundLabel();

/* ğŸš€ å¼·åˆ¶å°å‘ v3.htmlï¼ˆé¿å…è¢«çˆ¶é /iframe æ””æˆªï¼‰ */
const V3_URL = 'https://neoxcoin.github.io/neox-game/v3.html#fromOpening3';
function goV3(){
  try{
    if (window.top && window.top !== window) {
      window.top.location.href = V3_URL; // ç›´æ¥é ‚å±¤è·³è½‰
    } else {
      location.replace(V3_URL);
    }
  }catch(e){
    location.href = V3_URL;
  }
}

/* Start Playï¼šå…ˆè©¦æ’­ï¼›è‹¥ 1.2s å…§ç„¡åæ‡‰ â†’ ç›´æ¥é–‹ mp4 */
async function tryPlayWithFallback(){
  try{ ensureAudio(); await audioCtx?.resume?.(); }catch(e){}
  let started = false;
  const onPlaying = ()=>{ started = true; cleanup(); };
  const onTime = ()=>{ if (video.currentTime > 0) { started = true; cleanup(); } };
  function cleanup(){
    video.removeEventListener('playing', onPlaying);
    video.removeEventListener('timeupdate', onTime);
  }
  video.addEventListener('playing', onPlaying, { once:true });
  video.addEventListener('timeupdate', onTime);
  try{ await video.play(); }catch(e){}

  setTimeout(()=>{
    if(!started){
      cleanup();
      location.href = 'https://neoxcoin.github.io/neox-game/TreasureL3Opening.mp4';
    }
  }, 1200);
}

/* ç¶å®šäº‹ä»¶ï¼ˆåªæœ‰ä¸‰ç²’æ£ï¼‰ */
btnStart.addEventListener('click', tryPlayWithFallback);
btnSkip .addEventListener('click', goV3);
video.addEventListener('ended', goV3);

/* ç¬¬ä¸€æ¬¡è§¸æ§æ™‚ç¢ºä¿å¯ä»¥æ’­æ”¾ï¼ˆiOS è§£é–ï¼‰ */
['pointerdown','touchend','click','keydown'].forEach(evt=>{
  window.addEventListener(evt, async ()=>{
    if(video.paused){ try{ await video.play(); }catch(e){} }
  }, { once:true, passive:true });
});
</script>
</body>
</html>