<!-- v1.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Catch ‚Äì Level 1</title>
<style>
  html, body { height:100%; margin:0; background:#0a0b1f; color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif; overflow:hidden; }
  #wrap{ position:relative; height:100%; display:grid; place-items:center; }
  canvas{ display:block; width:min(92vw,700px); aspect-ratio:9/16; height:auto; border-radius:16px; background:#000;
    box-shadow:0 20px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06); touch-action:none; }

  .hud{ position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr auto; pointer-events:none;}
  .topbar{ display:flex; justify-content:space-between; align-items:center; gap:10px; padding:10px 14px; }
  .left{display:flex; gap:8px; align-items:center;}
  .badges{ display:flex; gap:8px; flex-wrap:wrap;}
  .badge{ padding:8px 12px; border-radius:12px; background:rgba(255,255,255,.16); font-weight:800; }
  .home-btn{ pointer-events:auto; display:inline-flex; align-items:center; gap:8px; background:#1b2248; padding:8px 10px;
    border-radius:12px; box-shadow:0 10px 24px rgba(0,0,0,.25); text-decoration:none; color:#dfe7ff; font-weight:800; }
  .home-btn img{ width:22px; height:22px; display:block; }
  .home-btn span{ display:none; }
  .pause-btn{ pointer-events:auto; background:#1b2248; padding:10px 12px; border-radius:12px; font-weight:800; }

  .center{ display:grid; place-items:center; padding:10px;}
  .panel{ pointer-events:auto; min-width:clamp(240px,80%,520px); text-align:center; padding:18px 16px 20px; border-radius:14px;
    background:rgba(10,12,34,.85); box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06); backdrop-filter: blur(4px); }
  .panel h1{ margin:8px 0 6px; font-size: clamp(20px,4.8vw,28px);}
  .panel p{ margin:6px 0 14px; color:#b9c1ff; font-size:14px; line-height:1.5;}
  .row{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap;}
  button{ pointer-events:auto; border:0; border-radius:10px; padding:10px 14px; font-weight:800; background:#2b7cff; color:#fff; cursor:pointer; box-shadow:0 8px 22px rgba(43,124,255,.35); }
  button.alt{ background:#1f2648; box-shadow: inset 0 0 0 1px rgba(255,255,255,.10); }
  .hidden{ display:none !important; }
  .level-banner{ position:absolute; left:50%; top:60px; transform:translateX(-50%); background:rgba(255,255,255,.12); border-radius:999px; padding:8px 14px; font-weight:800; letter-spacing:.3px; pointer-events:none; }
</style>
</head>
<body>
  <div id="wrap">
    <canvas id="game" width="450" height="800" aria-label="NeoX Catch Level 1"></canvas>

    <div class="hud" aria-live="polite">
      <div class="topbar">
        <div class="left">
          <a id="btnHome" class="home-btn" href="index.html">
            <img src="https://neoxcoin.github.io/neox-game/XNXC.png" alt="Home"><span>Home</span>
          </a>
          <div class="badges">
            <div class="badge" id="scoreBadge">Score: 0</div>
            <div class="badge" id="bestBadge">Best: 0</div>
          </div>
        </div>
        <button id="btnPause" class="pause-btn">‚è∏ Pause</button>
      </div>

      <div class="center">
        <div id="panelStart" class="panel">
          <h1>NeoX Catch ‚Äì Level 1</h1>
          <p>Move the <b>Treasure Box</b> to catch falling <b>NeoX Coins</b>.<br>Keyboard <b>‚Üê ‚Üí</b> or tap/drag left & right.</p>
          <div class="row"><button id="btnStart">‚ñ∂ Start</button></div>
        </div>

        <div id="panelPause" class="panel hidden">
          <h1>Paused</h1>
          <div class="row">
            <button id="btnResume">‚èµ Resume</button>
            <button id="btnRestart2" class="alt">üîÑ Restart</button>
          </div>
        </div>

        <div id="panelWin" class="panel hidden">
          <h1>Level 1 Clear!</h1>
          <p><span id="finalScore">Score: 0</span><br><span id="bestScore">Best: 0</span></p>
          <div class="row">
            <button id="btnLevel2">Go to Level 2 ‚ñ∂</button>
            <button id="btnReplay" class="alt">Replay</button>
          </div>
        </div>
      </div>

      <div class="level-banner hidden" id="levelBanner">LEVEL 1</div>
    </div>
  </div>

<script>
/* URLs */
const BG_URL   = "https://neoxcoin.github.io/neox-game/forest%20background%20.PNG";
const CHEST_URL= "https://neoxcoin.github.io/neox-game/treasure-box.png";
const COIN_URL = "https://neoxcoin.github.io/neox-emoji-128.png";
const HOME_URL = "index.html";   /* ‚Üê Â∑≤ÊîπÊàêÂõû‰∏ªÈ†Å */

/* HiDPI */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
function fitHiDPI(){ const cssW=canvas.clientWidth, cssH=canvas.clientHeight; const dpr=Math.max(1,Math.min(devicePixelRatio||1,2));
  if(canvas.width!==Math.round(cssW*dpr)){ canvas.width=Math.round(cssW*dpr); canvas.height=Math.round(cssH*dpr); }
  ctx.setTransform(dpr,0,0,dpr,0,0); }
fitHiDPI(); addEventListener('resize', fitHiDPI);

/* State */
const State={READY:0,PLAYING:1,PAUSED:2,WIN:3}; let state=State.READY;

/* HUD refs */
const scoreBadge=document.getElementById('scoreBadge');
const bestBadge=document.getElementById('bestBadge');
const panelStart=document.getElementById('panelStart');
const panelPause=document.getElementById('panelPause');
const panelWin=document.getElementById('panelWin');
const finalScore=document.getElementById('finalScore');
const bestScoreEl=document.getElementById('bestScore');
const levelBanner=document.getElementById('levelBanner');
document.getElementById('btnHome').href = HOME_URL;

/* Images */
const bgImg=new Image(), chestImg=new Image(), coinImg=new Image();
bgImg.src=BG_URL; chestImg.src=CHEST_URL; coinImg.src=COIN_URL;
let bgReady=false,chestReady=false,coinReady=false;
bgImg.onload=()=>bgReady=true; chestImg.onload=()=>chestReady=true; coinImg.onload=()=>coinReady=true;

/* Chest (player) */
const chest={x:225,y:0,w:200,h:144,speed:6.2,vx:0};
function layoutChest(){
  const w=canvas.clientWidth, h=canvas.clientHeight;
  const targetW=Math.min(220, Math.max(120, w*0.34));
  chest.w=targetW; chest.h=Math.round(targetW*0.72);
  const isLand=matchMedia('(orientation: landscape)').matches;
  const bottomMargin=/Mobile|Android|iPhone|iPad/i.test(navigator.userAgent) ? 20 : (isLand?Math.max(24,Math.round(h*0.05)):Math.max(24,Math.round(h*0.03)));
  chest.y=h-bottomMargin;
}
layoutChest(); addEventListener('resize', layoutChest); addEventListener('orientationchange', layoutChest);

/* Utils */
function rand(a,b){return Math.random()*(b-a)+a;}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

/* Level / Score */
const LEVEL={target:10,vy:[2.0,2.8],spawn:[0.9,1.2],concurrent:3,mult:1.0};
let caught=0, spawnTimer=0, score=0; let best=Number(localStorage.getItem('neox_catch_best')||0);
const coins=[];

/* Audio */
let audioCtx=null, masterGain=null, soundOn=true;
function ensureAudio(){ if(audioCtx) return; audioCtx=new (window.AudioContext||window.webkitAudioContext)(); masterGain=audioCtx.createGain(); masterGain.gain.value=.8; masterGain.connect(audioCtx.destination); }
async function resumeAudio(){ try{ ensureAudio(); if(audioCtx.state!=='running') await audioCtx.resume(); }catch(e){} }
function beep({f=440,d=.12,t='sine',g=.2,decay=.02,start=0}){ if(!soundOn||!audioCtx) return; const n=audioCtx.currentTime+start, o=audioCtx.createOscillator(), ga=audioCtx.createGain();
  o.type=t; o.frequency.value=f; ga.gain.value=g; ga.gain.exponentialRampToValueAtTime(0.0001, n+Math.max(.01,d-decay)); o.connect(ga).connect(masterGain); o.start(n); o.stop(n+d); }
const SFX={ click(){beep({f:700,d:.07,t:'triangle',g:.12});}, catch(){beep({f:880,d:.08,g:.18});}, win(){[660,880,990,1320].forEach((f,i)=>beep({f,d:.14,g:.14,start:i*.09}))} };

/* UI */
function show(el,s=true){ el.classList.toggle('hidden',!s); }
function flashLevelBanner(text){ levelBanner.textContent=text; show(levelBanner,true); setTimeout(()=>show(levelBanner,false),1100); }
function refreshHUD(){ scoreBadge.textContent=`Score: ${Math.floor(score)}`; bestBadge.textContent=`Best: ${Math.floor(best)}`; }

document.getElementById('btnStart').onclick   = ()=>{ SFX.click(); start(); };
document.getElementById('btnPause').onclick   = ()=>{ SFX.click(); togglePause(); }; // Á¨¨‰∏ÄÊ¨°Êö´ÂÅúÔºåÁ¨¨‰∫åÊ¨°ÊÅ¢Âæ©
document.getElementById('btnResume').onclick  = ()=>{ SFX.click(); togglePause(false); };
document.getElementById('btnRestart2').onclick= ()=>{ SFX.click(); restart(); };
document.getElementById('btnReplay').onclick  = ()=>{ SFX.click(); restart(); };
document.getElementById('btnLevel2').onclick  = ()=>{ SFX.click(); location.href='v2.html'; };

/* Input */
const keys=new Set();
addEventListener('keydown',e=>{ if(e.repeat) return;
  if(e.key==='ArrowLeft') keys.add('L');
  if(e.key==='ArrowRight') keys.add('R');
  if(e.key.toLowerCase()==='p') togglePause();
  if(state===State.READY && (e.key===' '||e.key==='Enter')) start();
});
addEventListener('keyup',e=>{ if(e.key==='ArrowLeft') keys.delete('L'); if(e.key==='ArrowRight') keys.delete('R'); });
let pointerId=null;
function onPointerDown(e){ const p=(e.changedTouches&&e.changedTouches[0])||e; pointerId=p.identifier??'mouse'; if(state===State.READY) start(); e.preventDefault(); }
function onPointerMove(e){ const p=(e.changedTouches && ([...e.changedTouches].find(t => (t.identifier ?? 'mouse')===pointerId)))||e; if(!p) return;
  const rect=canvas.getBoundingClientRect(), cx=(p.clientX-rect.left)/rect.width*canvas.clientWidth; const diff=cx-chest.x; chest.vx=clamp(diff*0.25,-chest.speed,chest.speed); e.preventDefault(); }
function onPointerUp(e){ pointerId=null; chest.vx=0; e.preventDefault(); }
canvas.addEventListener('pointerdown', onPointerDown, {passive:false});
addEventListener('pointermove', onPointerMove, {passive:false});
addEventListener('pointerup', onPointerUp, {passive:false});
addEventListener('pointercancel', onPointerUp, {passive:false});
['pointerdown','keydown'].forEach(evt=>window.addEventListener(evt, resumeAudio, {once:true, passive:true}));
addEventListener('blur', ()=>{ if(state===State.PLAYING) togglePause(true); });

/* Flow */
function start(){ score=0; caught=0; coins.length=0; spawnTimer=0; chest.x=canvas.clientWidth/2; chest.vx=0; layoutChest();
  state=State.PLAYING; show(panelStart,false); show(panelPause,false); show(panelWin,false); flashLevelBanner('LEVEL 1'); refreshHUD(); }
function togglePause(forcePause){
  if(state===State.PLAYING && (forcePause??true)){ state=State.PAUSED; show(panelPause,true); document.getElementById('btnPause').textContent='‚èµ Resume'; }
  else if(state===State.PAUSED){ state=State.PLAYING; show(panelPause,false); document.getElementById('btnPause').textContent='‚è∏ Pause'; }
}
function win(){ state=State.WIN; best=Math.max(best,Math.floor(score)); localStorage.setItem('neox_catch_best', String(best));
  finalScore.textContent=`Score: ${Math.floor(score)}`; bestScoreEl.textContent=`Best: ${Math.floor(best)}`; refreshHUD(); SFX.win(); show(panelWin,true); }
function restart(){ show(panelWin,false); show(panelPause,false); start(); }

/* Spawn & Loop */
function spawnCoins(dt){ spawnTimer-=dt;
  if(spawnTimer<=0 && coins.length<LEVEL.concurrent){ coins.push({x:rand(14,canvas.clientWidth-14),y:-20,r:12,vy:rand(LEVEL.vy[0],LEVEL.vy[1]),spin:rand(0,Math.PI*2),vspin:rand(-0.12,0.12)}); spawnTimer=rand(LEVEL.spawn[0],LEVEL.spawn[1]); } }
let last=performance.now();
function loop(now){
  requestAnimationFrame(loop); fitHiDPI(); const dt=Math.min(50,now-last)/16.6667; last=now;
  drawBackground();
  if(state===State.PLAYING){
    chest.vx=(keys.has('L')?-chest.speed:0) + (keys.has('R')?chest.speed:0) || chest.vx*0.92;
    chest.x=clamp(chest.x+chest.vx, chest.w/2+8, canvas.clientWidth-chest.w/2-8);
    spawnCoins(dt); for(const c of coins){ c.y+=c.vy*dt; c.spin+=c.vspin*dt; }
    const mouth={cx:chest.x, cy:chest.y-chest.h*0.60, rx:chest.w*0.38, ry:chest.h*0.18};
    for(let i=coins.length-1;i>=0;i--){ const c=coins[i]; const ex=(c.x-mouth.cx)/mouth.rx, ey=(c.y-mouth.cy)/mouth.ry;
      if(ex*ex+ey*ey<=1){ score+=10; caught++; coins.splice(i,1); SFX.catch(); refreshHUD(); if(caught>=LEVEL.target) win(); }
      else if(c.y>canvas.clientHeight+30){ coins.splice(i,1); }
    }
  }
  drawChest(); drawCoins();
  if(state===State.READY){ ctx.font='600 18px system-ui, -apple-system, "Segoe UI"'; ctx.textAlign='center'; ctx.fillStyle='rgba(255,255,255,.9)'; ctx.fillText('Tap or press Space to start', canvas.clientWidth/2, canvas.clientHeight*0.62); }
}
requestAnimationFrame(loop);

/* Rendering */
function drawBackground(){ const w=canvas.clientWidth,h=canvas.clientHeight; ctx.clearRect(0,0,w,h);
  if(!bgReady){ const g=ctx.createLinearGradient(0,0,0,h); g.addColorStop(0,"#0f1240"); g.addColorStop(1,"#0a0c22"); ctx.fillStyle=g; ctx.fillRect(0,0,w,h); return; }
  const iw=bgImg.width, ih=bgImg.height, ir=iw/ih, cr=w/h; let dw,dh,dx,dy; if(ir>cr){ dh=h; dw=h*ir; dx=(w-dw)/2; dy=0; } else { dw=w; dh=w/ir; dx=0; dy=(h-dh)/2; } ctx.drawImage(bgImg,dx,dy,dw,dh);
}
function drawChest(){ const {x,y,w,h}=chest; const glow=ctx.createRadialGradient(x,y-24,6,x,y-24,120); glow.addColorStop(0,'rgba(43,124,255,0.30)'); glow.addColorStop(1,'rgba(43,124,255,0)');
  ctx.fillStyle=glow; ctx.beginPath(); ctx.arc(x,y-24,90,0,Math.PI*2); ctx.fill();
  if(chestReady){ ctx.save(); ctx.shadowColor='rgba(0,0,0,0.35)'; ctx.shadowBlur=18; ctx.drawImage(chestImg, x-w/2, y-h, w, h); ctx.restore(); }
  else { ctx.fillStyle='#1c274f'; ctx.fillRect(x-w/2, y-h, w, h); }
}
function drawCoins(){ for(const c of coins){ const size=c.r*3, r=size/2; ctx.save(); ctx.translate(c.x,c.y); ctx.rotate(c.spin);
  if(coinReady){ ctx.save(); ctx.shadowColor='rgba(255,223,128,0.8)'; ctx.shadowBlur=18; ctx.drawImage(coinImg,-r,-r,size,size); ctx.restore(); }
  else { const g=ctx.createRadialGradient(0,0,r*0.2,0,0,r); g.addColorStop(0,'#fff6cc'); g.addColorStop(1,'#e3b23c'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill(); }
  ctx.restore(); } }
</script>
</body>
</html>