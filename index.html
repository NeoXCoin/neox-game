<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Treasure – Start</title>
<style>
  :root{ --bg:#060a1a; --panel:#0b1030; --brand:#2b7cff; }
  html,body{margin:0;height:100%;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"PingFang TC","Noto Sans TC"}
  .shell{position:fixed;inset:0;overflow:hidden;padding-bottom:env(safe-area-inset-bottom)}
  /* 首屏（介紹 + 播片） */
  #home{position:absolute;inset:0;display:grid;place-items:center;padding:clamp(16px,3vw,32px)}
  .card{max-width:min(900px,92vw);background:rgba(255,255,255,.04);border-radius:16px;
        box-shadow:0 24px 80px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
        padding:clamp(16px,3.2vw,28px);backdrop-filter:blur(6px)}
  h1{margin:.2em 0 .4em;font-size:clamp(22px,5.4vw,36px);letter-spacing:.02em}
  p{margin:.4em 0 1em;color:#cfe0ff;line-height:1.7}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  button{border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
  .primary{background:var(--brand);color:#fff;box-shadow:0 12px 28px rgba(43,124,255,.45)}
  .ghost{background:#151a3a;color:#e6ecff;box-shadow:inset 0 0 0 1px rgba(255,255,255,.08)}
  small{opacity:.7}
  /* 影片覆蓋層 */
  #opener{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:#000;z-index:10}
  #opener video{width:100%;height:100%;object-fit:cover}
  #tap{position:absolute;inset:auto 0 8% 0;text-align:center;color:#fff;opacity:.85;display:none}
  /* 真正遊戲區（iframe 全屏） */
  #stage{position:absolute;inset:0;display:none}
  iframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000}
  .credit{position:fixed;left:12px;bottom:calc(10px + env(safe-area-inset-bottom));opacity:.55;font-size:12px}
</style>
</head>
<body>
<div class="shell">
  <!-- 首頁：介紹 + 動畫按鈕 -->
  <section id="home" aria-label="Game intro">
    <div class="card">
      <h1>NeoX Catch the Coins</h1>
      <p>
        用底部的托盤接住掉下來的 <b>NeoX Coins</b>，不同硬幣分數不同，漏接或接到假幣會扣分。<br>
        完成目標數量即可升級，連續命中可衝高分數！支援手機觸控同鍵盤操作。
      </p>
      <ul>
        <li>🎯 目標：完成每關指定數量</li>
        <li>🕹️ 操作：左右點按／拖曳，或鍵盤 ← →</li>
        <li>🔊 可開關音效</li>
      </ul>
      <div class="btns">
        <button id="btnPlayOpener" class="ghost">▶ 播放開場動畫</button>
        <button id="btnStartGame" class="primary">Start Game</button>
      </div>
      <small>提示：先看開場動畫，再開始遊戲更有代入感。</small>
    </div>
  </section>

  <!-- 開場動畫層 -->
  <div id="opener" role="dialog" aria-label="Opening animation">
    <video id="openerVideo" playsinline preload="auto"
           src="NeoXcatchgameOpening%20.mp4"></video>
    <div id="tap">點擊以播放 / 繼續</div>
  </div>

  <!-- 遊戲容器 -->
  <section id="stage" aria-hidden="true">
    <iframe id="gameFrame" src="about:blank" allow="autoplay; fullscreen"></iframe>
  </section>

  <div class="credit">© NeoX</div>
</div>

<script>
const home   = document.getElementById('home');
const opener = document.getElementById('opener');
const video  = document.getElementById('openerVideo');
const tap    = document.getElementById('tap');
const stage  = document.getElementById('stage');
const frame  = document.getElementById('gameFrame');

// 1) 播放開場動畫
document.getElementById('btnPlayOpener').onclick = async()=>{
  opener.style.display='flex';
  tap.style.display='none';
  try{
    // 盡量自動播放（iOS 可能需要互動）
    await video.play();
  }catch{
    tap.style.display='block';
  }
};
// 使用者點擊影片層時也嘗試播放/繼續
opener.addEventListener('click', async()=>{
  if(video.paused) { try{ await video.play(); tap.style.display='none'; }catch{} }
});

// 影片播完 → 顯示 Start Game 按鈕變化 & 收起影片層
video.addEventListener('ended', ()=>{
  opener.style.display='none';
});

// 2) 進入遊戲 v1
function enterGame(){
  home.style.display='none';
  opener.style.display='none';
  stage.style.display='block';
  frame.src = 'v1.html';
}
document.getElementById('btnStartGame').onclick = enterGame;

// 3) 後續切關（保持原有 postMessage 溝通）
let level=1,total=0;
window.addEventListener('message',(e)=>{
  const m=e.data||{};
  if(m.type==='levelComplete'){
    total += (m.levelScore||0);
    level++;
    if(level===2) frame.src='v2.html';
    else if(level===3) frame.src='v3.html';
    else {
      // 可在此加入 End Game 影片或勝利畫面
    }
  }
});
</script>
</body>
</html>