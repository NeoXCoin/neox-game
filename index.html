<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Catch Game — Opening</title>
<style>
  html,body{
    margin:0;height:100%;background:#05081A;color:#fff;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial,sans-serif;
    overflow:hidden
  }

  /* ===== 1) Intro Banner ===== */
  #banner{
    position:absolute;inset:0;display:grid;place-items:center;text-align:center;z-index:10;
    background:
      linear-gradient(rgba(5,8,26,.60),rgba(5,8,26,.90)),
      url('https://neoxcoin.github.io/neox-game/TreasureSite%20.JPG') center/cover no-repeat;
    animation:bannerFadeIn 1.6s ease forwards;
  }
  @keyframes bannerFadeIn{from{opacity:0;transform:scale(1.03)}to{opacity:1;transform:scale(1)}}

  #bannerText{opacity:0;max-width:min(900px,92vw);line-height:1.7;
    font-size:clamp(16px,3.2vw,20px);padding:clamp(16px,3vw,28px)}
  #bannerText h1{
    margin:.1em 0 .2em;
    font-size:clamp(28px,6vw,48px);
    letter-spacing:.06em;
    text-shadow:0 0 18px #41b0ff66,0 0 40px #41b0ff33;
  }
  #bannerText .tagline{
    font-size:clamp(15px,3vw,20px);
    color:#c9d8ff;
    font-weight:500;
    letter-spacing:.05em;
    text-shadow:0 0 10px rgba(100,170,255,.35);
  }
  .fade-in{animation:fadein 1.2s ease forwards}
  @keyframes fadein{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  /* ===== 2) Opener Video Layer ===== */
  #opener{
    position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:11;
    overflow:hidden;
    background:
      linear-gradient(rgba(3,6,23,.60),rgba(5,10,31,.90)),
      url('https://neoxcoin.github.io/neox-game/TreasureSite%20.JPG') center/cover no-repeat;
  }
  #opener video{
    width:100%;height:100%;object-fit:contain;background:#000;
    opacity:0;transition:opacity .6s ease;
  }
  #tap{
    position:absolute;left:0;right:0;bottom:calc(8% + env(safe-area-inset-bottom));
    text-align:center;color:#fff;opacity:.92;display:none;
  }
  #loadingSpinner{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:12px;color:#bcd4ff;
  }
  .spinner{
    width:46px;height:46px;border:4px solid #ffffff24;border-top-color:#2b7cff;border-radius:50%;
    animation:spin 1.1s linear infinite;filter:drop-shadow(0 0 8px #2b7cff99);
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* ===== 3) Transition FX (Coin Burst) ===== */
  #transitionFx{
    position:absolute;inset:0;display:none;place-items:center;z-index:12;pointer-events:none;overflow:hidden;
  }
  #transitionFx .flash{position:absolute;inset:0;background:#fff;opacity:0;}
  #transitionFx .pulse{
    position:absolute;left:50%;top:50%;width:130px;height:130px;
    transform:translate(-50%,-50%) scale(.3);
    background:url('https://neoxcoin.github.io/neox-emoji-128.png') center/contain no-repeat;
    filter:drop-shadow(0 0 20px rgba(80,150,255,.8)) drop-shadow(0 0 40px rgba(43,124,255,.4));
    opacity:.95;
  }
  @keyframes fx-flash{0%{opacity:0}20%{opacity:1}100%{opacity:0}}
  @keyframes fx-coinburst{
    0%{transform:translate(-50%,-50%) scale(.3);opacity:1}
    60%{transform:translate(-50%,-50%) scale(6);opacity:.45}
    100%{transform:translate(-50%,-50%) scale(8);opacity:0}
  }
  .fx-run .flash{animation:fx-flash .52s ease-out forwards;}
  .fx-run .pulse{animation:fx-coinburst .9s ease-out forwards;}

  /* ===== 4) Start Layer ===== */
  #startLayer{
    position:absolute;inset:0;display:none;place-items:center;background:rgba(5,8,20,.85);
    z-index:13;opacity:0;transition:opacity 1s ease;
  }
  #startLayer.visible{opacity:1;}
  #startBtn{
    background:#2563eb;color:#fff;font-weight:900;font-size:clamp(20px,6vw,36px);
    letter-spacing:.05em;padding:18px 34px;border-radius:14px;cursor:pointer;
    box-shadow:0 0 25px rgba(37,99,235,.6);animation:pop-in 1.1s ease forwards;
  }
  @keyframes pop-in{
    0%{transform:scale(.85);opacity:0}
    70%{transform:scale(1.05);opacity:1}
    100%{transform:scale(1);opacity:1}
  }
</style>
</head>
<body>

<!-- 1) Banner -->
<section id="banner">
  <div id="bannerText">
    <h1>NeoX Catch Game</h1>
    <p class="tagline">Your journey to NeoX begins here. Catch the coins. Unlock the future.</p>
  </div>
</section>

<!-- 2) Opener -->
<section id="opener" aria-label="Opening animation">
  <div id="loadingSpinner"><div class="spinner"></div><span>Loading opening…</span></div>
  <video id="openerVideo"
         playsinline webkit-playsinline preload="metadata" muted
         src="https://neoxcoin.github.io/neox-game/NeoXcatchgameOpening%20.mp4"></video>
  <div id="tap">Tap to play / continue</div>
</section>

<!-- 3) Transition -->
<div id="transitionFx" aria-hidden="true">
  <div class="flash"></div>
  <div class="pulse"></div>
</div>

<!-- 4) Start -->
<section id="startLayer" aria-hidden="true">
  <div id="startBtn">▶ START GAME</div>
</section>

<!-- Background Music -->
<audio id="introMusic" preload="auto"
  src="https://neoxcoin.github.io/neox-game/NeoX_OpeningTheme_Cartoon.wav"></audio>

<script>
/* ---------- Elements ---------- */
const banner=document.getElementById('banner');
const bannerText=document.getElementById('bannerText');
const opener=document.getElementById('opener');
const video=document.getElementById('openerVideo');
const tap=document.getElementById('tap');
const spinner=document.getElementById('loadingSpinner');
const trans=document.getElementById('transitionFx');
const startLayer=document.getElementById('startLayer');
const startBtn=document.getElementById('startBtn');
const music=document.getElementById('introMusic');

/* ---------- Music Control ---------- */
let audioCtx,gainNode,buffer,source;
async function ensureAudio(){
  if(buffer) return;
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const res=await fetch(music.src); const data=await res.arrayBuffer();
  buffer=await audioCtx.decodeAudioData(data);
}
async function playMusic(vol=0.8){
  await ensureAudio();
  if(audioCtx.state!=='running') await audioCtx.resume();
  source=audioCtx.createBufferSource(); gainNode=audioCtx.createGain();
  source.buffer=buffer; source.connect(gainNode).connect(audioCtx.destination);
  gainNode.gain.value=0; source.start(0); fadeGain(0,vol,1500);
}
function fadeGain(from,to,ms){
  if(!gainNode) return; const now=audioCtx.currentTime;
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(from,now);
  gainNode.gain.linearRampToValueAtTime(to,now+ms/1000);
}
function fadeOut(ms=1000){ if(gainNode){ const now=audioCtx.currentTime; gainNode.gain.linearRampToValueAtTime(0,now+ms/1000); }}

/* ---------- 1) Banner ---------- */
setTimeout(()=>bannerText.classList.add('fade-in'),200);
setTimeout(()=>playMusic(0.6),600); // banner phase BGM
setTimeout(()=>{
  banner.style.transition='opacity 1s ease'; banner.style.opacity='0';
  fadeOut(1000);
  setTimeout(()=>{ banner.style.display='none'; startOpening(); },1000);
},4500);

/* ---------- 2) Opener Video ---------- */
function fitVideoObject(){
  const r=(video.videoWidth||16)/(video.videoHeight||9);
  const s=innerWidth/innerHeight;
  video.style.objectFit=Math.abs(r-s)<0.18?'cover':'contain';
}
video.addEventListener('loadedmetadata',fitVideoObject);
addEventListener('resize',fitVideoObject,{passive:true});

async function startOpening(){
  opener.style.display='flex';
  try{ await video.play(); }catch(e){ tap.style.display='block'; }
}
video.addEventListener('loadeddata',()=>{ spinner.style.display='none'; video.style.opacity='1'; });
video.addEventListener('playing',()=>{
  spinner.style.display='none'; video.style.opacity='1'; tap.style.display='none';
  setTimeout(()=>{ video.muted=false; },0);
});
['touchend','pointerup','click'].forEach(evt=>{
  opener.addEventListener(evt,tryPlay,{passive:true});
  video.addEventListener(evt,tryPlay,{passive:true});
});
let controlsFallback=false;
async function tryPlay(){
  if(!video.paused) return;
  tap.style.display='none';
  const wasMuted=video.muted; video.muted=true;
  try{ await video.play(); setTimeout(()=>video.muted=wasMuted,0); }
  catch(e){
    if(!controlsFallback){
      controlsFallback=true; video.controls=true;
      tap.textContent='Press ▶ to start'; tap.style.display='block';
    }
  }
}
setTimeout(()=>{
  if(video.paused){ video.controls=true; tap.textContent='Press ▶ to start'; tap.style.display='block'; }
},5000);

/* ---------- 3) Transition + Music ---------- */
video.addEventListener('ended',()=>{
  playTransition();
  setTimeout(()=>playMusic(0.8),600);
});
function playTransition(){
  trans.style.display='grid'; trans.classList.remove('fx-run');
  requestAnimationFrame(()=>trans.classList.add('fx-run'));
  setTimeout(()=>{ trans.style.display='none'; showStartLayer(); },950);
}

/* ---------- 4) Start Game ---------- */
function showStartLayer(){ startLayer.style.display='grid'; requestAnimationFrame(()=>startLayer.classList.add('visible')); }
startBtn.addEventListener('click',()=>{
  startLayer.classList.remove('visible'); fadeOut(800);
  setTimeout(()=>{
    startLayer.style.display='none';
    try{ audioCtx && audioCtx.close(); }catch(e){}
    window.location.href='v1.html';
  },900);
});
</script>
</body>
</html>