<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>NeoX Catch Game – 開場動畫</title>
<style>
  html,body{margin:0;height:100%;background:#05081A;color:#fff;font-family:'Noto Sans TC',sans-serif;overflow:hidden;}

  /* ===== Banner 介紹 ===== */
  #banner{
    position:absolute;inset:0;display:grid;place-items:center;text-align:center;
    background:radial-gradient(circle at center,#0b1450 0%,#070b25 60%,#040713 100%);
    z-index:10;
  }
  #bannerText{opacity:0;max-width:90%;line-height:1.6;font-size:clamp(16px,3vw,20px);}
  .fade-in{animation:fadein 1.6s ease forwards;}
  @keyframes fadein{to{opacity:1;transform:none}}

  /* ===== 開場動畫影片 ===== */
  #opener{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:11;
           background:radial-gradient(circle at center,#030617 0%,#050a1f 100%);}
  #opener video{width:100%;height:100%;object-fit:contain;background-color:#000;opacity:0;transition:opacity .6s ease;}

  /* ===== 影片後爆光轉場 ===== */
  #transitionFx{position:absolute;inset:0;display:none;place-items:center;z-index:12;pointer-events:none;overflow:hidden;}
  #transitionFx .flash{position:absolute;inset:0;background:#fff;opacity:0;}
  #transitionFx .pulse{
    position:absolute;left:50%;top:50%;width:130px;height:130px;
    transform:translate(-50%,-50%) scale(0.3);
    background:url('https://neoxcoin.github.io/neox-emoji-128.png') center/contain no-repeat;
    filter:drop-shadow(0 0 20px rgba(80,150,255,.8)) drop-shadow(0 0 40px rgba(43,124,255,.4));
    opacity:.95;
  }
  @keyframes fx-flash{0%{opacity:0}20%{opacity:1}100%{opacity:0}}
  @keyframes fx-coinburst{
    0%{transform:translate(-50%,-50%) scale(0.3);opacity:1}
    60%{transform:translate(-50%,-50%) scale(6);opacity:.45}
    100%{transform:translate(-50%,-50%) scale(8);opacity:0}
  }
  .fx-run .flash{animation:fx-flash .52s ease-out forwards}
  .fx-run .pulse{animation:fx-coinburst .9s ease-out forwards}

  /* ===== Start Layer ===== */
  #startLayer{position:absolute;inset:0;display:grid;place-items:center;background:rgba(5,8,20,.85);
              z-index:13;opacity:0;transition:opacity 1.2s ease;}
  #startLayer.visible{opacity:1;}
  #startBtn{
    background:#2563eb;color:#fff;font-weight:900;font-size:clamp(20px,6vw,36px);
    letter-spacing:.05em;padding:18px 34px;border-radius:14px;cursor:pointer;
    box-shadow:0 0 25px rgba(37,99,235,.6);
    animation:pop-in 1.3s ease forwards;
  }
  @keyframes pop-in{0%{transform:scale(0.8);opacity:0}70%{transform:scale(1.05);opacity:1}100%{transform:scale(1);opacity:1}}

  .hidden{display:none}
</style>
</head>
<body>

<!-- 遊戲介紹 Banner -->
<div id="banner">
  <div id="bannerText">
    <h1>NeoX Catch Game</h1>
    <p>接住從天而降的 NeoX Coin！<br>訓練你的反應力，挑戰更高分數！</p>
  </div>
</div>

<!-- 開場動畫 -->
<div id="opener">
  <video id="openerVideo" playsinline preload="auto"
    src="https://neoxcoin.github.io/neox-game/NeoXcatchgameOpening%20.mp4"></video>
</div>

<!-- 影片轉場 -->
<div id="transitionFx">
  <div class="flash"></div>
  <div class="pulse"></div>
</div>

<!-- Start Game 層 -->
<div id="startLayer" class="hidden">
  <div id="startBtn">▶ START GAME</div>
</div>

<!-- 音樂 -->
<audio id="introMusic" preload="auto" 
       src="https://neoxcoin.github.io/neox-game/NeoX_OpeningTheme_Cartoon.wav"></audio>

<script>
const banner=document.getElementById('banner');
const bannerText=document.getElementById('bannerText');
const opener=document.getElementById('opener');
const video=document.getElementById('openerVideo');
const trans=document.getElementById('transitionFx');
const startLayer=document.getElementById('startLayer');
const startBtn=document.getElementById('startBtn');
const music=document.getElementById('introMusic');

/* ====== Step 1: Banner → 淡入文字 ====== */
setTimeout(()=>bannerText.classList.add('fade-in'),200);
setTimeout(()=>{
  banner.style.transition='opacity 1s ease';
  banner.style.opacity='0';
  setTimeout(()=>{banner.style.display='none'; startOpening();},1000);
},4000);

/* ====== Step 2: 播開場動畫 ====== */
async function startOpening(){
  opener.style.display='flex';
  try{ await video.play(); }catch{}
}

/* ====== Step 3: 音樂控制 ====== */
let audioCtx,gainNode,source;
async function playMusic(){
  if(!audioCtx){
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    const res=await fetch(music.src);
    const buffer=await res.arrayBuffer();
    const decoded=await audioCtx.decodeAudioData(buffer);
    source=audioCtx.createBufferSource();
    gainNode=audioCtx.createGain();
    source.buffer=decoded; source.connect(gainNode).connect(audioCtx.destination);
    source.start(0);
    gainNode.gain.value=0;
  }
  audioCtx.resume();
  fadeGain(0,0.8,2000);
}
function fadeGain(from,to,duration){
  if(!gainNode)return;
  const now=audioCtx.currentTime;
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(from,now);
  gainNode.gain.linearRampToValueAtTime(to,now+duration/1000);
}
video.addEventListener('play',playMusic);

/* ====== Step 4: 影片結束 → 爆光 + 音樂淡出 ====== */
video.addEventListener('ended',()=>{
  fadeGain(0.8,0,1200);
  playTransition();
});
function playTransition(){
  trans.style.display='grid';
  trans.classList.remove('fx-run');
  requestAnimationFrame(()=>trans.classList.add('fx-run'));
  setTimeout(()=>{
    trans.style.display='none';
    showStartLayer();
  },950);
}

/* ====== Step 5: 顯示 Start Game ====== */
function showStartLayer(){
  startLayer.classList.remove('hidden');
  requestAnimationFrame(()=>startLayer.classList.add('visible'));
}

/* ====== Step 6: 進入遊戲 ====== */
startBtn.addEventListener('click',()=>{
  startLayer.classList.remove('visible');
  setTimeout(()=>{
    startLayer.classList.add('hidden');
    if(audioCtx) audioCtx.close();
    window.location.href="v1.html";
  },800);
});
</script>

</body>
</html>