<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX — End Game</title>
<style>
  html,body{
    height:100%;margin:0;background:#05081A;color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif;
    overflow:hidden;
  }
  #wrap{position:relative;height:100%;display:grid;place-items:center;}
  .stage{
    position:relative;width:min(92vmin,720px);aspect-ratio:1/1;
    border-radius:16px;background:#000;
    box-shadow:0 22px 60px rgba(0,0,0,.45),inset 0 0 0 1px rgba(255,255,255,.07);
    overflow:hidden;
  }
  video{
    width:100%;height:100%;object-fit:contain;background:#000;opacity:0;
    transition:opacity .8s ease;
  }
  .headline{
    position:absolute;left:50%;top:10%;
    transform:translateX(-50%);
    text-align:center;text-shadow:0 6px 22px rgba(0,0,0,.55);
    transition:opacity 1.5s ease;
  }
  .headline.fade-out{opacity:0;}
  h1{margin:0 0 8px;font-size:clamp(22px,5.2vw,36px);}
  p{margin:0;color:#cfe0ff;font-weight:700;}
  #panel{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    min-width:min(92vw,520px);padding:18px 16px 20px;border-radius:16px;
    text-align:center;background:rgba(10,12,34,.9);
    box-shadow:0 20px 60px rgba(0,0,0,.5),inset 0 0 0 1px rgba(255,255,255,.08);
    backdrop-filter:blur(6px);display:none;opacity:0;transition:opacity 1.5s ease;
  }
  button{
    border:0;border-radius:12px;padding:12px 18px;color:#fff;font-weight:900;
    background:#1b2144;cursor:pointer;box-shadow:0 10px 28px rgba(0,0,0,.25);
  }
  button:hover{background:#2b36a4;}
  button img{width:22px;height:22px;vertical-align:middle;margin-right:6px;}
</style>
</head>
<body>
<div id="wrap">
  <div class="stage">
    <video id="endVid" playsinline webkit-playsinline preload="auto"
      src="https://neoxcoin.github.io/neox-game/Endgameanimation%20.mp4"></video>
    <audio id="bgm" preload="auto"
      src="https://neoxcoin.github.io/neox-game/victory-music.mp3"></audio>

    <div class="headline" id="headline">
      <h1>Victory!</h1>
      <p id="scoreText">Score: 0 · Best: 0</p>
    </div>

    <div id="panel">
      <h2>Great Job! 🎉</h2>
      <p id="finalText">Score: 0 · Best: 0</p>
      <button id="btnHome">
        <img src="https://neoxcoin.github.io/neox-game/XNXC.png" alt="NeoX">Home
      </button>
    </div>
  </div>
</div>

<script>
const video = document.getElementById("endVid");
const bgm = document.getElementById("bgm");
const headline = document.getElementById("headline");
const scoreText = document.getElementById("scoreText");
const finalText = document.getElementById("finalText");
const panel = document.getElementById("panel");
const btnHome = document.getElementById("btnHome");

// 分數讀取
const params = new URLSearchParams(location.search);
const score = params.get("score") || localStorage.getItem("nx_last_score") || 0;
const best  = params.get("best")  || localStorage.getItem("nx_best_all") || 0;
scoreText.textContent = `Score: ${score} · Best: ${best}`;
finalText.textContent = `Score: ${score} · Best: ${best}`;

// 自動播放
async function startAll(){
  try{
    await video.play();
    await bgm.play(); // 播放背景音樂
    video.style.opacity = '1';
    // 淡出文字
    headline.classList.add('fade-out');
  }catch(e){
    console.log("需要點擊互動才能播放音樂:", e);
  }
}
addEventListener("DOMContentLoaded", startAll);

// 播放完影片後顯示面板
video.addEventListener("ended", ()=>{
  panel.style.display = "block";
  setTimeout(()=> panel.style.opacity = "1", 100);
});

// 回主頁
btnHome.onclick = ()=> window.location.href = "index.html";
</script>
</body>
</html>