 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX â€” End Game</title>
<style>
  html,body{height:100%;margin:0;background:#05081A;color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif;overflow:hidden}
  #wrap{position:relative;height:100%;display:grid;place-items:center}

  /* å½±ç‰‡é‹ªæ’ï¼ˆä¸è£åˆ‡ï¼‰ */
  #vid{width:100%;height:100%;object-fit:contain;background:#000;opacity:0;transition:opacity .6s ease}
  /* ç–Šåœ¨å½±ç‰‡ä¸Šçš„åº•éƒ¨è³‡è¨Šå±¤ */
  .overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;
    text-align:center;background:linear-gradient(transparent 60%, rgba(0,0,0,.65)); padding:24px 12px}
  h1{margin:.2em 0 .4em; font-weight:900; font-size:clamp(22px,6vw,40px)}
  .muted{color:#cbd5ff; margin:0 0 10px}

  /* æ§åˆ¶åˆ— */
  .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .btn{border:0;border-radius:12px;padding:12px 16px;font-weight:900;color:#fff;cursor:pointer;
       background:#1b2144; box-shadow:0 10px 28px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.08)}
  .primary{background:#2b7cff}
  .ghost{background:#101634}

  /* çµç®—é¢æ¿ï¼ˆå½±ç‰‡æ’­å®Œæ‰å‡ºç¾ï¼‰ */
  #panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);min-width:min(92vw,520px);
    padding:18px 16px 20px;border-radius:16px;text-align:center;background:rgba(10,12,34,.9);
    box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.08); backdrop-filter:blur(6px);
    display:none}
  #panel h2{margin:.2em 0 .3em; font-size:clamp(22px,6vw,36px)}
  #panel p{margin:0 0 14px; color:#c8d2ff}
</style>
</head>
<body>
<div id="wrap">
  <video id="vid" playsinline webkit-playsinline muted preload="auto"
    src="https://neoxcoin.github.io/neox-game/NeoX_End_Game_VictoryGlow%202.mp4"></video>

  <!-- æ’­æ”¾ä¸­é¡¯ç¤ºï¼šæ¨™é¡Œ + è²éŸ³/é–‹å§‹/è·³é -->
  <div class="overlay" id="ovr">
    <h1>Victory!</h1>
    <p class="muted" id="scoreText">Score: 0 Â· Best: 0</p>
    <div class="row">
      <button id="btnSound" class="btn">ğŸ”ˆ Play with sound</button>
      <button id="btnPlay"  class="btn primary">â–¶ Start</button>
      <button id="btnSkip"  class="btn ghost">â­ Skip</button>
    </div>
  </div>

  <!-- å½±ç‰‡æ’­å®Œæ‰é¡¯ç¤º -->
  <div id="panel">
    <h2>Great Job! ğŸ‰</h2>
    <p id="finalText">Score: 0 Â· Best: 0</p>
    <div class="row">
      <button class="btn ghost"  id="btnReplay">ğŸ” Replay</button>
      <button class="btn primary" id="btnHome">ğŸ  Home</button>
    </div>
  </div>
</div>

<script>
/* ============ è®€å–åˆ†æ•¸ï¼ˆQuerystring æˆ– localStorage å‚™æ´ï¼‰ ============ */
const url = new URL(location.href);
const score = Number(url.searchParams.get('score') ?? localStorage.getItem('nx_last_score') ?? 0);
const best  = Number(url.searchParams.get('best')  ?? localStorage.getItem('nx_best_all')   ?? 0);
// åŒæ­¥å¯«å›ï¼Œæ–¹ä¾¿é‡æ–°æ•´ç†é‚„åœ¨
localStorage.setItem('nx_last_score', String(score));
localStorage.setItem('nx_best_all', String(best));

/* ============ UI refs ============ */
const vid = document.getElementById('vid');
const ovr = document.getElementById('ovr');
const scoreText = document.getElementById('scoreText');
const finalText = document.getElementById('finalText');
const btnSound = document.getElementById('btnSound');
const btnPlay  = document.getElementById('btnPlay');
const btnSkip  = document.getElementById('btnSkip');
const panel    = document.getElementById('panel');
const btnHome  = document.getElementById('btnHome');
const btnReplay= document.getElementById('btnReplay');

scoreText.textContent = `Score: ${score} Â· Best: ${best}`;
finalText.textContent = `Score: ${score} Â· Best: ${best}`;

/* ============ è‡ªå‹•æ’­æ”¾è™•ç†ï¼ˆè¡Œå‹•è£ç½®éœéŸ³å•Ÿæ’­ï¼‰ ============ */
function showVideo(){ vid.style.opacity = '1'; }
async function tryPlayMuted(){ try{ await vid.play(); showVideo(); }catch(e){} }
addEventListener('DOMContentLoaded', tryPlayMuted, {once:true});
['touchstart','pointerdown','keydown','click'].forEach(evt=>{
  window.addEventListener(evt, tryPlayMuted, {once:true, passive:true});
});

/* ============ æ§åˆ¶éµ ============ */
btnPlay.onclick = async ()=>{ try{ await vid.play(); showVideo(); }catch(e){} };
btnSound.onclick = async ()=>{
  try{ vid.muted = false; await vid.play(); btnSound.textContent = 'ğŸ”Š Sound on'; btnSound.disabled = true; }catch(e){}
};
btnSkip.onclick = ()=> endFlow();

/* å½±ç‰‡æ’­å®Œ â†’ é¡¯ç¤ºé¢æ¿ */
vid.addEventListener('ended', endFlow);
function endFlow(){
  ovr.style.display = 'none';
  panel.style.display = 'block';
}

/* é¢æ¿æŒ‰éˆ• */
btnHome.onclick   = ()=> location.href = 'index.html';
btnReplay.onclick = ()=> location.href = 'v3.html#replay';
</script>
</body>
</html>
