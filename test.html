<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>NeoX Catch ‚Äî Level 3 (Rebuild)</title>
<style>
html,body{
  height:100%;margin:0;background:#070a18;color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang TC","Noto Sans",Arial,sans-serif;
  overflow:hidden;
}
#wrap{position:relative;height:100%;display:grid;place-items:center}

/* ===== ÈÅäÊà≤ËàûÂè∞ ===== */
.stage{position:relative;width:min(92vw,700px);aspect-ratio:9/16;border-radius:16px;
  box-shadow:0 22px 60px rgba(0,0,0,.45), inset 0 0 1px rgba(255,255,255,.06);overflow:hidden;}
.bgvid{position:absolute;inset:0;display:grid;place-items:center;z-index:0;pointer-events:none}
.bgvid video{width:100%;height:100%;object-fit:contain;object-position:center center;border-radius:16px;background:#000}
canvas{position:absolute;inset:0;z-index:2;width:100%;height:100%;display:block;border-radius:16px;background:transparent;touch-action:none}

/* ===== HUD ===== */
.hud{position:absolute;inset:0;z-index:10;pointer-events:none;}
.topbar{position:absolute;left:0;right:0;top:calc(8px + env(safe-area-inset-top,0px));padding:10px 14px;display:block;pointer-events:none;}
.topbar .left{position:absolute;left:10px;top:10px;pointer-events:auto;}
.topbar .right{position:absolute;right:10px;top:10px;pointer-events:auto;}
.topbar .center{position:absolute;left:50%;top:10px;transform:translateX(-50%);text-align:center;pointer-events:none;}
.badge{display:inline-block;padding:8px 12px;margin:0 6px;border-radius:12px;font-weight:900;background:rgba(0,0,0,.38);
  backdrop-filter:blur(3px);box-shadow:inset 0 0 0 1px rgba(255,255,255,.15);}
.iconbtn{display:inline-flex;align-items:center;gap:8px;background:#1b2144;color:#fff;border:0;border-radius:14px;
  padding:10px 14px;font-weight:800;box-shadow:0 10px 28px rgba(0,0,0,.25),inset 0 0 0 1px rgba(255,255,255,.08);pointer-events:auto;}
.iconbtn img{width:22px;height:22px;object-fit:contain;display:block}

/* ===== ÈñãÂ†¥ÂãïÁï´ ===== */
#opening{
  position:absolute;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.9);
  z-index:50;animation:fadein .6s ease both;
}
#opening.fadeout{animation:fadeout .6s ease forwards;}
@keyframes fadein{from{opacity:0}to{opacity:1}}
@keyframes fadeout{from{opacity:1}to{opacity:0}}
.open-panel{text-align:center;}
.open-panel h1{font-size:1.5em;margin-bottom:1em;}
.open-panel button{
  margin:6px;padding:10px 16px;font-weight:800;border:0;border-radius:10px;cursor:pointer;
}
#btnSound{background:#2b7cff;color:#fff;}
#btnPlay{background:#00c37a;color:#fff;}
#btnSkip{background:#444;color:#fff;}

/* ===== ÁµêÁÆóÈù¢Êùø ===== */
.panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:auto;min-width:clamp(240px,80%,520px);
  text-align:center;padding:18px 16px 20px;border-radius:16px;background:rgba(10,12,34,.88);
  box-shadow:0 20px 60px rgba(0,0,0,.5),inset 0 0 0 1px rgba(255,255,255,.08);backdrop-filter:blur(4px);z-index:30;}
.hidden{display:none !important;}
.btn{border:0;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer;color:#fff;background:#2b7cff;
  box-shadow:0 8px 22px rgba(43,124,255,.35);margin:5px;}
.btn.alt{background:#1f2648;box-shadow:inset 0 0 0 1px rgba(255,255,255,.1)}
</style>
</head>
<body>
<div id="wrap">
  <div class="stage">
    <div class="bgvid"><video id="bgVideo" muted loop playsinline preload="auto"
      src="https://neoxcoin.github.io/neox-game/v3_animation_BG.mp4"></video></div>
    <canvas id="game" width="450" height="800"></canvas>

    <div class="hud">
      <div class="topbar">
        <div class="left">
          <button id="btnHome" class="iconbtn"><img src="https://neoxcoin.github.io/neox-game/XNXC.png" alt="home">Home</button>
        </div>
        <div class="center">
          <span class="badge" id="scoreBadge">Score: 0</span>
          <span class="badge" id="timeBadge">Time: 03:00</span>
          <span class="badge" id="bestBadge">Best: 0</span>
        </div>
        <div class="right"><button id="btnPause" class="iconbtn">‚è∏ Pause</button></div>
      </div>
    </div>

    <div id="panelWin" class="panel hidden">
      <h1>Great Job! üéâ</h1>
      <p><span id="finalScore">Score: 0</span></p>
      <div>
        <button id="btnReplay" class="btn alt">Replay</button>
        <button id="btnHome2" class="btn">üè† Home</button>
      </div>
    </div>

    <div id="opening">
      <div class="open-panel">
        <h1>NeoX Catch ‚Äî Level 3</h1>
        <button id="btnSound">üîä Sound On</button>
        <button id="btnPlay">‚ñ∂Ô∏è Play</button>
        <button id="btnSkip">Skip</button>
      </div>
    </div>
  </div>
</div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
const bgVideo=document.getElementById("bgVideo");
let score=0,best=0,timeLeft=180,state="ready",items=[];
const scoreBadge=document.getElementById("scoreBadge");
const timeBadge=document.getElementById("timeBadge");
const bestBadge=document.getElementById("bestBadge");
const panelWin=document.getElementById("panelWin");
const finalScore=document.getElementById("finalScore");
const btnPause=document.getElementById("btnPause");

/* Èü≥Êïà */
let audioCtx=null,masterGain=null;
function initAudio(){audioCtx=new (window.AudioContext||window.webkitAudioContext)();masterGain=audioCtx.createGain();masterGain.connect(audioCtx.destination);}
function beep(f){if(!audioCtx)return;const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.connect(g).connect(masterGain);
g.gain.setValueAtTime(.2,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+.2);
o.frequency.setValueAtTime(f,audioCtx.currentTime);o.start();o.stop(audioCtx.currentTime+.2);}
function playSound(){if(!audioCtx){initAudio();}audioCtx.resume();bgVideo.play().catch(()=>{});}

/* ÈñãÂ†¥ÂãïÁï´ÊéßÂà∂ */
const opening=document.getElementById("opening");
document.getElementById("btnSound").onclick=()=>playSound();
document.getElementById("btnPlay").onclick=()=>startGame();
document.getElementById("btnSkip").onclick=()=>fadeOutOpening();
setTimeout(()=>fadeOutOpening(),5000);
function fadeOutOpening(){opening.classList.add("fadeout");setTimeout(()=>opening.style.display="none",600);}
function startGame(){fadeOutOpening();state="playing";bgVideo.play();}

/* ÈÅäÊà≤‰∏ªÈ´î */
const chest={x:225,y:760,w:200,h:140,vx:0,speed:6};
function drawChest(){ctx.fillStyle="#1c274f";ctx.fillRect(chest.x-chest.w/2,chest.y-chest.h,chest.w,chest.h);}
function spawnItem(){items.push({x:Math.random()*400,y:-10,v:2+Math.random()*2});}
function update(dt){
  if(state!=="playing")return;
  timeLeft-=dt;
  if(timeLeft<=0)return endGame();
  if(Math.random()<0.05)spawnItem();
  items.forEach(it=>it.y+=it.v*5);
  items=items.filter(it=>{
    if(it.y>chest.y-chest.h && Math.abs(it.x-chest.x)<chest.w/2){
      score+=10;beep(1000);return false;
    }
    return it.y<800;
  });
  updateHUD();
}
function draw(){
  ctx.clearRect(0,0,450,800);
  drawChest();
  ctx.fillStyle="#ffcc00";
  items.forEach(it=>ctx.beginPath(),ctx.arc(it.x,it.y,10,0,2*Math.PI),ctx.fill());
}
function loop(){
  update(0.016);draw();requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

function updateHUD(){
  scoreBadge.textContent=`Score: ${score}`;
  timeBadge.textContent=`Time: ${Math.floor(timeLeft/60)}:${String(Math.floor(timeLeft%60)).padStart(2,"0")}`;
  bestBadge.textContent=`Best: ${best}`;
}
function endGame(){
  state="ended";
  best=Math.max(best,score);
  finalScore.textContent=`Score: ${score}`;
  panelWin.classList.remove("hidden");
}
document.getElementById("btnReplay").onclick=()=>{score=0;timeLeft=180;items=[];panelWin.classList.add("hidden");state="playing";updateHUD();}
</script>
</body>
</html>
